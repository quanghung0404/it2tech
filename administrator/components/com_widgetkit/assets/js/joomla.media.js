!function(e){function t(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}angular.module("widgetkit").service("mediaPicker",["$templateCache","$compile","$q","$rootScope","filterFilter","UIkit","mediaRequest","Application",function(i,n,o,r,c,l,a,s){var d,u,f,p,m,h,g=/\.(jpe?g|png|gif|svg|mp3|ogg|wav|mp4|wmv|ogv|webm)$/i,w=!1;return picker={init:function(c){return c&&c.allowedFiletypes&&(w=c.allowedFiletypes),this.options=angular.extend({multiple:!1},c),m=o.defer(),u=e(i.get("media")),f=u.data("media-path"),p=n(u)(r).scope(),p.vm=this,p.selectItem=function(i,n){if(n.shiftKey&&h){t();for(var o,r=e(n.target).closest("li"),c=r.parent().children(),l=r.index()>h.index()?1:-1,a=1===l?h.index():r.index(),s=1===l?r.index():h.index(),d=a;s>=d;d++)o=c.eq(d).scope(),o[o.folder?"folder":"file"].selected=!0}else i.selected=!i.selected;h=e(n.target).closest("li")},this.open("").then(function(){if(window.widgetkit.env.modal){var t=window.widgetkit.env.modal.element.children(":first").hide();picker.close=function(){t.show(),u.remove()},t.parent().append(u)}else picker.modal=e.UIkit.modal(e('<div class="uk-modal">').append(u).appendTo("body")).show(),picker.close=function(){picker.modal.hide()},e.UIkit.domObserve(picker.modal.element);picker.initUpload()}),m.promise},initUpload:function(){var t=e("#wk-upload-progressbar"),i=t.find(".uk-progress-bar"),n={param:"Filedata[]",params:{"Content-Type":"multipart/form-data"},allow:"*.(jpeg|jpg|gif|png|svg|mp3|ogg|wav|mp4|wmv|ogv|webm)",before:function(e,t){e.action=a.url({task:"file.upload",tmpl:"component",format:"html",folder:d},!0)},loadstart:function(){i.css("width","0%").text("0%"),t.removeClass("uk-hidden")},progress:function(e){e=Math.ceil(e)+"%",i.css("width",e).text(e)},allcomplete:function(n){i.css("width","100%").text("100%"),e(n).find(".alert-error, .alert-info")[0]&&l.notify(e(n).find(".alert-error p, .alert-info p").html(),"danger"),setTimeout(function(){t.addClass("uk-hidden")},250),picker.open(d)}};l.uploadSelect(e("#wk-upload-select"),n),l.uploadDrop(u,n)},open:function(t){return a.get({view:"mediaList",tmpl:"component",folder:t,layout:"details"}).success(function(i){h=null,p.media=[],p.breadcrumbs=[];var n=e(i).find("tbody tr");".."==n.first().find(".description").text().trim()&&(n=n.not(n[0])),n.each(function(){var i=e(this),n=i.find("td:first a"),o=i.find("td :checkbox").val(),r=i.find("td.dimensions").text().trim().split(" x "),c=(t?t+"/":"")+o;p.media.push({title:o,path:c,url:(f?f+"/":"")+c,href:s.baseUrl()+"/"+(f?f+"/":"")+c,type:n.is("[target]")?"folder":"file",media:Boolean(c.match(g)),width:r[0],height:r[1],size:i.find("td.filesize").text().trim()})}),d=t;var o=(d?"/"+d:"").split("/");do p.breadcrumbs.unshift({path:o.join("/").substr(1),title:o.pop()});while(o.length);p.breadcrumbs[0].title="home"})},select:function(){var t=this.options,i=picker.getSelected(),n=[],o=[],r=function(e){return e.replace(/[_-]/g," ").replace(/\.[^\.]+$/,"").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)})};if(i.forEach(function(e){e.media||w&&e.path.match(w)?(e.title=r(e.title),o.push(e)):n.push(e)}),n.length){var c=[];n.forEach(function(t){var i=new Promise(function(i,n){a.get({view:"mediaList",tmpl:"component",folder:t.title,layout:"details"}).success(function(n){var c=e(n).find("tbody tr");".."==c.first().find(".description").text().trim()&&(c=c.not(c[0])),c.each(function(){var i=e(this),n=i.find("td:first a"),c=i.find("td :checkbox").val(),l=i.find("td.dimensions").text().trim().split(" x "),a=(t.title?t.title+"/":"")+c;if(a.match(g)){var d={title:r(c),path:a,url:(f?f+"/":"")+a,href:s.baseUrl()+"/"+(f?f+"/":"")+a,type:n.is("[target]")?"folder":"file",media:Boolean(a.match(g)),width:l[0],height:l[1],size:i.find("td.filesize").text().trim()};o.push(d)}}),i()})});c.push(i)}),Promise.all(c).then(function(){m.resolve(t.multiple||!o.length?o:o[0]),picker.close()})}else m.resolve(this.options.multiple||!o.length?o:o[0]),picker.close()},addFolder:function(){var e=prompt("Folder Name");e&&a.post({task:"folder.create",foldername:e,folderbase:d}).success(function(){picker.open(d)})},remove:function(){window.confirm("Are you sure?")&&a.post({task:"folder.delete",folder:d,rm:picker.getSelected().map(function(e){return e.title})}).success(function(){picker.open(d)})},getSelected:function(){return c(p.media,{selected:!0})}},{select:function(e){return picker.init(e)}}}]).service("mediaRequest",["$q","$http","Application",function(t,i,n){var o="index.php?option=com_media";return{get:function(e){return i.get(this.url(e))},post:function(t){return t[n.config.token]=1,i.post(o,e.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},url:function(t,i){return i&&(t[n.config.token]=1),o+"&"+e.param(t)}}}]),window.Promise=window.Promise||function(e,t){function i(e,t){return(typeof t)[0]==e}function n(r,c){return c=function l(a,s,d,u,f,p){if(u=l.q,a!=i)return n(function(e,t){u.push({p:this,r:e,j:t,1:a,0:s})});if(d&&i(e,d)|i(t,d))try{f=d.then}catch(m){s=0,d=m}if(i(e,f)){var h=function(e){return function(t){return f&&(f=0,l(i,e,t))}};try{f.call(d,h(1),s=h(0))}catch(m){s(m)}}else for(c=function(t,c){return i(e,t=s?t:c)?n(function(e,i){o(this,e,i,d,t)}):r},p=0;p<u.length;)f=u[p++],i(e,a=f[s])?o(f.p,f.r,f.j,d,a):(s?f.r:f.j)(d)},c.q=[],r.call(r={then:function(e,t){return c(e,t)},"catch":function(e){return c(0,e)}},function(e){c(i,1,e)},function(e){c(i,0,e)}),r}function o(n,o,r,c,l){setTimeout(function(){try{c=l(c),l=c&&i(t,c)|i(e,c)&&c.then,i(e,l)?c==n?r(TypeError()):l.call(c,o,r):o(c)}catch(a){r(a)}},0)}function r(e){return n(function(t){t(e)})}return n.resolve=r,n.reject=function(e){return n(function(t,i){i(e)})},n.all=function(e){return n(function(t,i,n,o){o=[],n=e.length||t(o),e.map(function(e,c){r(e).then(function(e){o[c]=e,n-=1,n||t(o)},i)})})},n}("f","o")}(jQuery);